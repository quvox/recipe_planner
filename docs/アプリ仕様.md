# 献立提案 PWA 仕様まとめ（更新版）

## 1. アプリ概要

- **目的**
    - 入力した食材・テーマ・人数構成を基に、AI が _時短料理_ の献立案を 3 件生成。
    - 過去に生成した献立を保存し、検索・再閲覧・削除できる。
    - **PWA として iPhone などにインストール可能 ＆ GitHub Pages でホスティング**。

## 2. 主要機能

### ホーム
- **献立を考える**
  - 「献立を考える」ボタンのみ表示
- **過去の献立を探す**
  - 「過去の献立を探す」ボタンのみ表示
- **各種設定**
  - ヘッダ領域の右端に歯車ボタンを表示し、歯車ボタンを押すと、フローティングメニューを表示する
  - フローティングメニューには、選択肢設定、APIトークン設定、データ管理、バージョン表示の項目を表示する
  - 選択肢設定画面、APIトークン設定画面、データ管理画面、バージョン表示画面はそれぞれ別の画面として構成する
  - メニューをクリックするとそれぞれの設定画面に遷移する


### 献立生成
- **入力フォーム**
  - **食材ボックス**: 追加・削除可（最低 1 個）
  - **テーマ**: 永続化されている選択肢を呼び出し、複数選択できるようにする。永続化情報がなければデフォルトを使う。（最低 1 個）
  - **人数構成**: 永続化されている選択肢を呼び出し、選択できるようにする。永続化情報がなければデフォルトを使う。
  
- **提案処理**
  
  - 必須項目をバリデーションを実施し、未入力があればエラーを表示する
  - 問題なければプロンプト生成 → AI へリクエスト
  - プロンプトは以下のようにする
  
  ```text
  あなたは料理研究家です。以下に提示する食材とテーマと条件に合った、短時間でできる献立を5つ考えてください。それぞれの献立には、献立のタイトルと見出し文、献立の味付けおよび詳細な説明、材料とその分量、所要時間、料理手順を説明してください。献立ごとにJSON形式で出力してください。
  # 食材
  * <食材を列挙する>
  # テーマ
  * <テーマを列挙する>
  # 人数構成
  * <人数構成を書く>
  ```
  
- **表示**
  - AI 返答はカード形式で表示
  - カードごとに保存ボタンを配置する。保存しなければ過去献立には登録されない
  - 重複して同じものが保存されないようにする
  - 各カードは「見出し」のみ一覧に表示し、タップでレシピ詳細を展開
  - 見出しは、文字数が多ければ...でトランケートするが、レシピ詳細では全文を表示する。
  - レシピ詳細には、献立の味付けおよび詳細な説明、材料とその分量、所要時間、料理手順を見やすく記載する。

### 過去献立
- **一覧表示**
  - 見出しのみカード表示（新しい順）
  - カードをタップして、献立詳細を展開表示する
- **採用不採用チェック**
  - その献立を採用した場合には採用ボタンを押して、採用されたことを記録する
  - その献立は使えないと判断した場合は、不採用ボタンを押して、不採用になったことを記録する
  - 採用・不採用はオンオフできること。つまり、何も選択していない状態、採用が選択されている状態、不採用が選択されている状態のいずれかになること。
- **操作**
  - 個別削除（確認ダイアログあり）

### 各種設定

- **選択肢設定**
  - 選択肢設定画面では、テーマの選択肢、人数構成の選択肢を設定できる
  - テーマの選択肢を追加、削除、修正する。またはデフォルトに戻す
  - テーマの選択肢のデフォルト設定は、`春` / `夏` / `秋` / `冬` / `がっつり` / `あっさり`。
  - 人数構成を追加、削除、修正する。またはデフォルトに戻す
  - 人数構成の選択肢のデフォルト設定は、`夫婦2人` / `夫婦と中高生3人` / `中高生3人`。
  - テーマ選択肢、人数構成を永続化する
  
- **APIトークン設定**
  - APIトークン設定画面では、OpenAIまたはClaudeのトークンを設定できる
  - OpenAIのAPIトークン設定、記憶、削除する
  - ClaudeのAPIトークン設定・記憶、削除する

- データ管理
  - データ管理画面では、エクスポート／インポートボタンを配置する

- バージョン表示
  - バージョン表示画面では、以下のバージョン情報を表示する
  - バージョン番号（セマンティックバージョニング）。package.jsonのversionから取得する
  - 作成日。ビルド日時をYYYY-MM-DDで表示する。
  - 作者。package.jsonのauthorから取得する。


### データ管理
- **永続化**
  - 保存項目: `献立詳細`, `作成日`, `入力食材リスト`
- **エクスポート／インポート**
  - JSON 形式で一括エクスポート／インポート

## 3. 画面遷移イメージ

```
[ホーム]
 ├─▶ 献立を考える
 │     ├─ 入力フォーム
 │     ├─ 提案結果（カード3件）
 │     └─ 保存 → ホーム
 ├─▶ 過去の献立を探す
 │     ├─ 一覧（見出し）
 │     ├─ 詳細表示
 │     └─ 削除
 └─▶ 各種設定
       ├─ 選択肢設定
       ├─ APIトークン設定
       └─ バージョン表示
```

## 4. AIプロンプト生成要件

- **目的**:

    - 指定食材・テーマ・人数構成を使い、短時間で作れる家庭向け時短料理の献立を5案生成させる。

- モデル

    - OpenAIで利用するモデルは、"o3-mini"とする
    - Claudeで利用するモデルは、"sonnet 4"とする

- **プロンプトテンプレート**（AI へ送信）

  ```text
  あなたは料理研究家です。以下に提示する食材とテーマと条件に合った、短時間でできる献立を5つ考えてください。それぞれの献立には、献立のタイトルと見出し文、献立の詳細な説明、材料とその分量、所要時間、料理手順を説明してください。また、献立のタイトルと見出し分には、それを見ただけでどのような味付けなのかがわかるようにしてください。
  # 食材
  * <食材を列挙する>
  # テーマ
  * <テーマを列挙する>
  # 人数構成
  * <人数構成を書く>
  ```

- **出力フォーマット指示例**（AI へ送信）

  ```text
  以下の JSON 配列で回答してください:
  [
    {
      "title": "献立名",
      "description": "見出し文",
      "detail": "献立の味付けおよび詳細な説明",
      "ingredients": ["材料とその分量"],
      "steps": ["料理手順1", "料理手順2", ...],
      "time": "所要時間"
    },
    ...
  ]
  ```

- **バリデーション**

    - フロント側で `JSON.parse` に成功するか確認。失敗時は再リクエスト。

## 5. 技術スタック & アーキテクチャ概要

### フロント

* app/の下に実装する

- React + Vite
- PWA (Service Worker, Manifest)
- オフライン時でも過去献立閲覧可
- バージョン情報のバージョン番号と作者は、package.jsonから取り込む。
- バージョン情報の作成日は、ビルド時に環境変数にセットして環境変数から取り込む。

### 状態管理
- Zustand / Redux Toolkit
- API キー・献立履歴を保持

### ストレージ
- IndexedDB (idb ラッパ)
- 献立履歴と設定をローカル保存

### サーバ通信
- fetch / axios
- AI API 呼び出し

### スタイル
- Tailwind CSS など
- モバイル優先デザイン

### ソースコードとコメント

* このマークダウンファイルに記載されている要件や設計との関係性がわかるように、適切かつ詳細にコメントをいれる
* 関数やメソッド、クラスには、その目的をコメントとして記述する

### **デプロイ**
- **GitHub Pages + GitHub Actions**
- `gh-pages` ブランチへ CI/CD。HTTPS・Service Worker 対応済み

## 6. データモデル（IndexedDB 例）

```ts
interface MenuRecord {
  id: string;            // UUID
  title: string;
  description: string;
  ingredients: string[];
  steps: string[];
  time: number;          // 分
  theme: string;
  peoplePattern: string; // 人数構成
  createdAt: string;     // ISO8601
  inputIngredients: string[];
}
```

## 7. 例外・エラーハンドリング

- 必須入力漏れ → フォーム下に赤字で表示。
- AI 返答フォーマット不備 → リトライ提案。
- ストレージ容量不足 → 警告モーダル表示。
- オフライン時の API 呼び出し → 「ネットワーク接続を確認してください」。

